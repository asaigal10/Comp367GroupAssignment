trigger:
- main  # Automatically triggers the pipeline on pushes to the main branch

pool:
  name: 'default'

steps:
# Step 1: Checkout Code
- task: Checkout@1
  displayName: "Checkout the Code Repository"

# Step 2: Setup Node.js
- task: UseNode@1
  displayName: "Set up Node.js"
  inputs:
    versionSpec: '16.x'  # Adjust based on your project requirements
    checkLatest: true

# Step 3: Install Backend Dependencies
- script: |
    cd backend
    npm install
  displayName: "Install Backend Dependencies"

# Step 4: Install Frontend Dependencies
- script: |
    cd frontend
    npm install
  displayName: "Install Frontend Dependencies"

# Step 5: Build Frontend
- script: |
    cd frontend
    npm run build
  displayName: "Build Frontend"

# Step 6: Run Backend Tests and Generate Coverage
- script: |
    cd backend
    npm test -- --coverage
  displayName: "Run Backend Tests and Generate Coverage"

# Step 7: Run Frontend Tests and Generate Coverage
- script: |
    cd frontend
    npm test -- --coverage
  displayName: "Run Frontend Tests and Generate Coverage"

# Step 8: Publish Test Results
- task: PublishTestResults@2
  displayName: "Publish Test Results"
  inputs:
    testResultsFormat: 'JUnit'
    testResultsFiles: '**/test-results.xml'
    failTaskOnFailedTests: true

# Step 9: Publish Code Coverage Report
- task: PublishCodeCoverageResults@1
  displayName: "Publish Code Coverage"
  inputs:
    codeCoverageTool: 'cobertura'
    summaryFileLocation: '**/coverage/cobertura-coverage.xml'
    reportDirectory: '**/coverage'
